[build.environment]
NODE_VERSION = "22"

# Plugins

[[plugins]]
package = "@algolia/netlify-plugin-crawler"
[plugins.inputs]
branches = [
  'main',
]

[[plugins]]
package = "@netlify/plugin-sitemap"
[plugins.inputs]
buildDir      = "_site"
prettyURLs    = true
trailingSlash = true

[[plugins]]
package = "netlify-plugin-inline-critical-css"

# Headers
# Headers for performance and security
# NOTE: Security headers in /* apply to all paths. More specific path patterns
# below override only Cache-Control; security headers are still inherited.

# HTML pages: always revalidate so visitors and crawlers get fresh content
[[headers]]
for = "/*"
[headers.values]
Cache-Control           = "public, max-age=0, must-revalidate"
X-Content-Type-Options  = "nosniff"
X-Frame-Options         = "DENY"
X-XSS-Protection        = "1; mode=block"
Referrer-Policy         = "strict-origin-when-cross-origin"
Permissions-Policy      = "camera=(), microphone=(), geolocation=()"
Content-Security-Policy = "upgrade-insecure-requests"
X-Robots-Tag            = "all"

[[headers]]
for = "/*.html"
[headers.values]
Cache-Control = "public, max-age=0, must-revalidate"

[[headers]]
for = "/sitemap.xml"
[headers.values]
Cache-Control = "public, max-age=3600"

[[headers]]
for = "/robots.txt"
[headers.values]
Cache-Control = "public, max-age=3600"

# Static assets: long cache (Quarto hashes filenames on rebuild)
[[headers]]
for = "/*.js"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "/*.css"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "/*.webp"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "/*.jpg"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "/*.png"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "/*.woff2"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "/*.woff"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

# Redirects

# Canonical: www -> apex
[[redirects]]
from   = "https://www.brainworkup.org/*"
to     = "https://brainworkup.org/:splat"
status = 301
force  = true

# HTTP -> HTTPS
[[redirects]]
from   = "http://brainworkup.org/*"
to     = "https://brainworkup.org/:splat"
status = 301
force  = true

# Alternate domains -> canonical (all with /* and :splat)
[[redirects]]
from   = "https://brainworkup.net/*"
to     = "https://brainworkup.org/:splat"
status = 301
force  = true

[[redirects]]
from   = "https://brainworkup.com/*"
to     = "https://brainworkup.org/:splat"
status = 301
force  = true

[[redirects]]
from   = "https://brainworkup.io/*"
to     = "https://brainworkup.org/:splat"
status = 301
force  = true

[[redirects]]
from   = "https://joeytrampush.com/*"
to     = "https://brainworkup.org/:splat"
status = 301
force  = true

[[redirects]]
from   = "https://www.joeytrampush.com/*"
to     = "https://brainworkup.org/:splat"
status = 301
force  = true

[[redirects]]
from   = "https://joeytrampush.net/*"
to     = "https://brainworkup.org/:splat"
status = 301
force  = true

# Legacy path redirects
[[redirects]]
from   = "/docs/projects/*"
to     = "/:splat"
status = 301
force  = true

[[redirects]]
from   = "/docs/faq/*"
to     = "/faq/"
status = 301
force  = true

[[redirects]]
from   = "/docs/pediatric-neuropsychology/*"
to     = "/pediatric-neuropsychology/"
status = 301
force  = true

[[redirects]]
from   = "/resources/cv.pdf"
to     = "/joey-trampush/cv.pdf"
status = 301
force  = true

[[redirects]]
from   = "/forensic-neuropsychology/trampush-joey_forensic-neuropsych_fee-schedule_2023-2024.pdf"
to     = "/forensic-neuropsychology/jwt_forensic_neuropsychology_fee_schedule_2023-2024.pdf"
status = 301
force  = true
